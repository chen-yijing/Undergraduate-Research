## 專題簡介
本專題針對洗腎患者的循環功能進行評估，透過上臂動脈阻斷實驗，結合影像處理與頻譜分析，分析其大血管、微血管及皮膚的循環反應，並與正常人數據進行比對，期望找出導致洗腎患者循環功能較差的原因。

---

## 程式建構環境
- **軟體**: Matlab、ENVI
- **研究流程**:  
  1. **影像對位**  
  2. **溫度校正**  
  3. **影像強化與重建**  
  4. **訊號去趨勢化**  
  5. **頻譜分析**  
  6. **結果呈現**

---

## 實驗流程
1. **實驗時長**: 25 分鐘  
   - 0-10 分鐘: 靜置期  
   - 10-15 分鐘: 血壓臂帶加壓至 180-200 mmHg，進行血流阻斷  
   - 15-25 分鐘: 放氣觀察血流回復  
2. **數據來源**: 利用熱像儀錄製影像，針對大血管、微血管及皮膚進行分析。
3. **分析方法**:  
   - 時域分析各組織反應  
   - 頻域進一步分析，並與正常人數據比對
  
---

## 步驟說明

### 1. **影像對位**
- 檔案名稱： `main_matching_file.m`  
- 功能： 因為在錄製患者手臂的25分鐘內，患者手臂會有些移動，會大幅影響數據的正確性。我們利用 Template Matching 方法，用患者手臂上貼的兩個三角形標記頂點作為對位點，對影像進行對位。

### **影像對位成效展示**  
以下展示影像對位的效果：  
1. Frame 1（基準影像）: 初始位置。  
2. Frame 1939（未對位）: 未經過對位處理，與 Frame 1 有明顯的偏移。  
3. Frame 1939（對位後）: 經過 Template Matching 處理，成功將偏移矯正，回到與 Frame 1 近乎一致的位置。  
    
| **基準影像 (Frame 1)** | **未對位 (Frame 1939)** | **對位後 (Frame 1939)** |
|-------------------------|-------------------------|--------------------------|
| ![Frame 1](https://github.com/user-attachments/assets/306617f0-238b-4253-9fae-a60941ffe08c) | ![Frame 1939 (未對位)](https://github.com/user-attachments/assets/7d15c226-37ab-4227-9289-23eda8b61f49) | ![Frame 1939 (對位後)](https://github.com/user-attachments/assets/b8278bb5-29d0-4006-94af-e564801032b6) |
    
### **對位分析**
- 未對位前問題： 未對位的 Frame 1939 顯示圈選的血管位置與 Frame 1 有明顯偏移，將會影響後續的數據分析準確性。
- 對位後成果： 利用 Template Matching 方法，成功將 Frame 1939 的位置調整回與基準影像 (Frame 1) 血管圈選位置近乎一致，減少了因偏移造成的誤差。

### 2. **溫度校正**
- **檔案名稱**: `temp_correct.m`  
- **功能**:  
  1. 用 ENVI 取出黑體平均溫度變化曲線。  
  2. 對影像進行溫度校正。  

### 3. **影像強化與重建**
- **檔案名稱**: `TSR.m`  
- **功能**:  
  1. 用 ENVI 調整影像對比度。  
  2. 進行熱影像信號重建（Thermographic Signal Reconstruction, TSR）。

### **影像強化與重建成效展示**  
| **原圖影像** | **原圖調整對比度後** | **經過一階TSR處理後** |
|-------------------------|-------------------------|--------------------------|
| ![image](https://github.com/user-attachments/assets/6677d278-6624-416e-b4ec-fb49188eddc7)| ![image](https://github.com/user-attachments/assets/d0346a11-4077-4acf-b24b-2068f3e221c3)| ![image](https://github.com/user-attachments/assets/ee35c119-f2dc-4000-a9b8-645575dd4865) |

### 4. **訊號去趨勢化與頻譜分析**
- **檔案名稱**: `myfft.m`  
- **功能**:  
  1. 對信號進行去趨勢化處理：  
     - 減去平均數  
     - 一次去趨勢（線性趨勢）  
     - 二次去趨勢（二次趨勢）  
     - 高通濾波（截止頻率為 0.004 Hz）  
  2. 快速傅立葉轉換（FFT）進行頻譜分析。  

### 5. **結果呈現**

針對三種組織（大血管、微血管及皮膚），選取前 1200 幀影像進行分析，以下為四種去趨勢化方法及 FFT 分析結果的比較：

#### **四種去趨勢化方法的結果展示**
| **分析方法**                      | **圖像結果**                                                                                 |
|------------------------------------|---------------------------------------------------------------------------------------------|
| **1. 減去平均溫度後的去趨勢化**   | ![Image 1](https://user-images.githubusercontent.com/76909063/192106756-f8337efd-538d-489c-a67e-e1b6ad2e9fb1.png) |
| **2. detrend 指令 (n=1)**          | ![Image 2](https://user-images.githubusercontent.com/76909063/192106794-ce96b4e3-ff91-4869-bba9-c08f2963b5c5.png) |
| **3. detrend 指令 (n=2)**          | ![Image 3](https://user-images.githubusercontent.com/76909063/192106811-6e09edef-c8c5-4e59-b0c2-687e50b7c026.png) |
| **4. highpass 指令 (0.004 Hz)**    | ![Image 4](https://user-images.githubusercontent.com/76909063/192106818-d14ccd5f-c67b-4ab1-a71b-467a93bc7c4c.png) |

### **四種去趨勢化方法的比較分析**
1. **減去平均溫度**  
   - 去除了基準偏移，保留了頻率波動的特徵。
   - 適合簡單的背景去趨勢分析。

2. **detrend 指令 (n=1)**  
   - 移除了線性趨勢，使信號波動更加明顯。
   - 適合處理漸進變化的數據。

3. **detrend 指令 (n=2)**  
   - 移除了二次趨勢，適合分析較為複雜的背景信號。

4. **highpass 指令 (截止頻率 0.004 Hz)**  
   - 適合進一步濾除低頻噪音，強調高頻成分。

### **頻譜段對應**
- 所有 FFT 分析結果劃分為四個頻率段，分別對應到不同的細胞活動：
   - 0.005-0.0095Hz: 微血管活動 
   - 0.0095-0.02Hz: 大血管動態
   - 0.02-0.06Hz: 皮膚表層響應 
   - 0.06-0.2Hz: 系統性反應
     
以下圖表展示了四個頻率段對應到的細胞活動：

![頻率段與細胞活動對應](https://user-images.githubusercontent.com/76909063/192107159-fd7409e2-4bf6-470c-a62d-85fb800d39ab.png)
